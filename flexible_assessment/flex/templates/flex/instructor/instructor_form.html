{% extends "flex/instructor/instructor_base.html" %}
{% load flextags %}


{% block content %}
  <h3>Instructor Form</h3>
  <form action="" method="post">
        {% csrf_token %}

        {{ formset.management_form }}
        {{ formset.non_form_errors }}
        {{ date_form.non_field_errors }}

        {% for hidden_field in date_form.hidden_fields %}
            {{ hidden_field.errors }}
            {{ hidden_field }}
        {% endfor %}

        <div id="form_set">
            <table class='table table-striped' style="width: 80%">
                <thead>
                    <tr>
                    <th style="text-align: center;">Title</th>
                    <th style="text-align: center;">Default %</th>
                    <th style="text-align: center;">Min %</th>
                    <th style="text-align: center;">Max %</th>
                    <th style="text-align: center;">Delete?</th>
                    </tr>
                </thead>
                <tbody>
                {% for form in formset.forms %}
                    {% for hidden in form.hidden_fields %}
                        {{ hidden }}
                    {% endfor %}
                    <tr>
                    {% for field in form.visible_fields %}
                            {% if form.non_field_errors and field.label == "Title" %}
                                <td style="text-align: center;">
                                    {{ form.non_field_errors }}
                                    {{ field.errors }}
                                    {{ field }}
                                </td>
                            {% else %}
                                <td style="text-align: center;">
                                    {{ field.errors }}
                                    {{ field }}
                                </td>
                            {% endif %}
                    {% endfor %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <input class="btn btn-outline-primary" type="button" value="Add Assessment" id="add_more">
        <table class='table table-bordered' style="margin-top: 20px; width: 10%">
            <thead>
                <tr>
                    <th>Open Date</th>
                    <th>Close Date</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ date_form.open }}</td>
                    <td>{{ date_form.close }}</td>
                </tr>
            </tbody>
        </table>
        <input class="btn btn-primary" type="submit" value="Submit">
    </form>
    <table id="empty_form" style="display:none">
        <tr>
            {% for field in formset.empty_form.visible_fields %}
                <td style="text-align: center;">
                    {{ field.errors }}
                    {{ field }}
                </td>
            {% endfor %}
        </tr>
    </table>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


    <script>
        $('#add_more').click(function() {
            var form_idx = $('#id_assessment-TOTAL_FORMS').val();
            console.log(form_idx)
            console.log($('#empty_form'))
            $('#form_set tr:last').after($('#empty_form').html().replace(/__prefix__/g, form_idx).replace(/<tbody>|<\/tbody>/g, ''));
            $('#id_assessment-TOTAL_FORMS').val(parseInt(form_idx) + 1);
            console.log($('#id_assessment-TOTAL_FORMS').val())
        });
    </script>
{% endblock %}
